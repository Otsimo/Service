#!/usr/bin/env node
"use strict";
/**
 * Module dependencies.
 */

var db = require('../lib/db');
var config = require('config');

var app, server;

function start() {
    return new Promise(function (resolve) {

        app = require('../lib/app');
        app.set('port', config.server.port);

        server = app.listen(app.get('port'), function () {
            console.log('Express server listening on port ' + server.address().port);
            resolve();
        });
    });

}


db.connect()
    .then(db.init)
    .then(start)
    .then(function () {             // All gone well log it
        console.log('Server has started');
    })
    .catch(function (error) {       //Something went wrong log it
        console.log('initialize' + error.stack);
        throw error;
    });